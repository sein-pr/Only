<div class="row">
    <div class="col-md-6">
        <img src="{{ product.image_url or '/placeholder.svg?height=300&width=300' }}" 
             class="img-fluid rounded" alt="{{ product.name }}">
    </div>
    <div class="col-md-6">
        <h5 class="fw-bold mb-2">{{ product.name }}</h5>
        <p class="text-muted mb-3">{{ product.description or 'No description available.' }}</p>
        
        <div class="mb-3">
            <span class="h4 fw-bold" style="color: #ea580c;">${{ "%.2f"|format(product.price) }}</span>
        </div>
        
        <div class="mb-3">
            {% if product.stock_quantity > 0 %}
                <span class="badge bg-success">In Stock</span>
            {% else %}
                <span class="badge bg-danger">Out of Stock</span>
            {% endif %}
        </div>
        
        <div class="d-grid gap-2">
            <button class="btn btn-primary" onclick="addToCartQuick('{{ product.id }}')" 
                    {% if product.stock_quantity == 0 or (session.user_id and product.seller_id == session.user_id) %}disabled{% endif %}>
                {% if session.user_id and product.seller_id == session.user_id %}
                    <i class="fas fa-user-shield me-2"></i>Your Own Product
                {% elif product.stock_quantity == 0 %}
                    <i class="fas fa-times me-2"></i>Out of Stock
                {% else %}
                    <i class="fas fa-cart-plus me-2"></i>Add to Cart
                {% endif %}
            </button>
            <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn btn-outline-primary" 
               onclick="trackFullDetailView('{{ product.id }}')">
                View Full Details
            </a>
        </div>
    </div>
</div>

<script>
function addToCartQuick(productId) {
    addToCartAPI(productId).then(data => {
        if (data.success) {
            // Close modal after successful add
            setTimeout(() => {
                bootstrap.Modal.getInstance(document.getElementById('quickViewModal')).hide();
            }, 1000);
        }
    });
}

function trackFullDetailView(productId) {
    // Track the full detail view when user clicks "View Full Details" from quick view
    fetch(`/api/product/${productId}/track-view`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ view_type: 'full_detail' })
    }).catch(error => {
        console.log('View tracking failed:', error);
        // Don't prevent navigation if tracking fails
    });
}
</script>
